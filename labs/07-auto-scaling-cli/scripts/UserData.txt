#!/bin/bash
# UserData script for web server initialization
# This script installs Apache, PHP, and a load testing application

# Update all installed packages
yum update -y

# Install Apache web server and PHP
yum install -y httpd php

# Download and install the load testing application
cd /var/www/html
wget https://aws-tc-largeobjects.s3.amazonaws.com/CUR-TF-100-RSJAWS-1-23732/198-lab-JAWS-autoscaling-linux/s3/scripts.zip
unzip scripts.zip
mv scripts/* .
rmdir scripts
rm scripts.zip

# Start Apache and configure it to start on boot
systemctl start httpd
systemctl enable httpd

# Clean up history and security information
find -wholename /root/.*history -wholename /home/*/.*history -exec rm -f {} \;
find / -name 'authorized_keys' -exec rm -f {} \;
rm -rf /var/lib/cloud/data/scripts/*
